# Ambiente de Desenvolvimento Rust: Guia Completo

## 1. Instalação do Rust

### 1.1 Instalação via Rustup (Recomendado)

**Windows:**
```bash
# Baixar e executar rustup-init.exe
# Ou via PowerShell:
Invoke-WebRequest -Uri "https://win.rustup.rs" -OutFile "rustup-init.exe"
./rustup-init.exe
```

**macOS/Linux:**
```bash
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
```

**Após instalação:**
```bash
# Recarregar variáveis de ambiente
source ~/.cargo/env

# Verificar instalação
rustc --version
cargo --version
rustup --version
```

### 1.2 Instalação Manual (Alternativa)

**Ubuntu/Debian:**
```bash
sudo apt update
sudo apt install rustc cargo
```

**Fedora:**
```bash
sudo dnf install rust cargo
```

**Arch Linux:**
```bash
sudo pacman -S rust
```

## 2. Estrutura Criada na Instalação

### 2.1 Diretórios Principais

```
~/.cargo/                          # Diretório principal do Cargo
├── bin/                           # Executáveis instalados
│   ├── cargo                      # Gerenciador de pacotes
│   ├── rustc                      # Compilador Rust
│   ├── rustdoc                    # Gerador de documentação
│   ├── rustfmt                    # Formatador de código
│   └── clippy                     # Linter
├── registry/                      # Cache de crates baixados
│   ├── cache/                     # Arquivos .crate comprimidos
│   ├── index/                     # Índice do registry
│   └── src/                       # Código fonte dos crates
└── git/                           # Dependências do Git

~/.rustup/                         # Diretório do Rustup
├── toolchains/                    # Toolchains instalados
│   ├── stable-x86_64-unknown-linux-gnu/
│   └── nightly-x86_64-unknown-linux-gnu/
├── downloads/                     # Downloads temporários
└── settings.toml                  # Configurações
```

### 2.2 Variáveis de Ambiente

```bash
# Principais variáveis criadas:
export CARGO_HOME="$HOME/.cargo"
export RUSTUP_HOME="$HOME/.rustup"
export PATH="$HOME/.cargo/bin:$PATH"

# Verificar variáveis:
echo $CARGO_HOME
echo $RUSTUP_HOME
echo $PATH | grep cargo
```

### 2.3 Ferramentas Instaladas

| Ferramenta | Função |
|------------|---------|
| `rustc` | Compilador principal |
| `cargo` | Gerenciador de pacotes e build |
| `rustdoc` | Gerador de documentação |
| `rustfmt` | Formatador de código |
| `clippy` | Linter com sugestões |
| `rustup` | Gerenciador de toolchains |

## 3. Estrutura de Projeto e Build

### 3.1 Criando um Projeto

```bash
# Criar projeto binário
cargo new meu_projeto
cd meu_projeto

# Criar projeto library
cargo new --lib minha_lib

# Estrutura gerada:
meu_projeto/
├── Cargo.toml                     # Manifesto do projeto
├── src/
│   └── main.rs                    # Código principal
└── .gitignore                     # Git ignore padrão
```

### 3.2 Arquivo Cargo.toml

```toml
[package]
name = "meu_projeto"
version = "0.1.0"
edition = "2021"

[dependencies]
serde = "1.0"
tokio = { version = "1.0", features = ["full"] }

[dev-dependencies]
criterion = "0.5"

[build-dependencies]
cc = "1.0"
```

### 3.3 Processo de Build

```bash
# Build de desenvolvimento (debug)
cargo build

# Build de produção (release)
cargo build --release

# Executar sem build explícito
cargo run

# Executar com argumentos
cargo run -- --help

# Testar
cargo test

# Documentação
cargo doc --open
```

### 3.4 Diretórios Gerados no Build

```
meu_projeto/
├── target/                        # Diretório de build
│   ├── debug/                     # Build de desenvolvimento
│   │   ├── build/                 # Scripts de build
│   │   ├── deps/                  # Dependências compiladas
│   │   ├── examples/              # Exemplos compilados
│   │   ├── incremental/           # Cache de compilação incremental
│   │   └── meu_projeto            # Binário final (debug)
│   ├── release/                   # Build de produção
│   │   ├── build/
│   │   ├── deps/
│   │   └── meu_projeto            # Binário final (release)
│   └── .rustc_info.json          # Info do compilador
├── Cargo.lock                     # Lock de dependências
├── Cargo.toml
└── src/
```

### 3.5 Detalhes das Pastas de Build

**target/debug/deps/**: Arquivos objeto (.rlib) das dependências
```bash
# Exemplo do conteúdo:
deps/
├── libserde-a1b2c3d4e5f6.rlib
├── libtokio-f6e5d4c3b2a1.rlib
├── meu_projeto-123abc456def.d     # Arquivo de dependências
└── meu_projeto-123abc456def.o     # Objeto compilado
```

**target/debug/build/**: Scripts de build customizados
```bash
build/
├── serde-a1b2c3d4/
│   ├── build-script-build         # Script de build
│   └── out/                       # Saída do build script
└── tokio-f6e5d4c3/
```

## 4. Otimizações e Dicas Importantes

### 4.1 Cache Global de Dependências

**Configurar cache compartilhado:**
```bash
# Criar arquivo ~/.cargo/config.toml
mkdir -p ~/.cargo
cat > ~/.cargo/config.toml << EOF
[source.crates-io]
replace-with = "vendored-sources"

[source.vendored-sources]
directory = "/path/to/vendor"

[build]
target-dir = "/tmp/rust-build"  # Build dir global
EOF
```

**Usar sccache para cache de compilação:**
```bash
# Instalar sccache
cargo install sccache

# Configurar no ~/.cargo/config.toml
[build]
rustc-wrapper = "sccache"
```

### 4.2 Workspaces (Monorepo)

```toml
# Cargo.toml na raiz
[workspace]
members = [
    "app",
    "lib",
    "utils"
]

# Compartilha target/ entre todos os projetos
```

### 4.3 Otimizações de Build

**Perfis de build otimizados:**
```toml
# Cargo.toml
[profile.dev]
opt-level = 1           # Otimização básica em dev
debug = true

[profile.release]
opt-level = 3           # Máxima otimização
lto = true             # Link Time Optimization
codegen-units = 1      # Melhor otimização
panic = "abort"        # Sem stack unwinding
```

**Build paralelo:**
```bash
# Usar todos os cores
cargo build -j $(nproc)

# Configurar permanentemente
echo 'export CARGO_BUILD_JOBS=$(nproc)' >> ~/.bashrc
```

### 4.4 Ferramentas de Desenvolvimento

**Instalar ferramentas úteis:**
```bash
# Melhor formatação
cargo install cargo-fmt

# Análise de dependências
cargo install cargo-tree
cargo install cargo-audit

# Hot reload
cargo install cargo-watch

# Benchmarking
cargo install cargo-criterion

# Profiling
cargo install cargo-flamegraph
```

### 4.5 Configuração de Editor

**VS Code com extensões:**
```json
{
  "rust-analyzer.server.path": "~/.cargo/bin/rust-analyzer",
  "rust-analyzer.checkOnSave.command": "clippy",
  "rust-analyzer.cargo.loadOutDirsFromCheck": true,
  "rust-analyzer.procMacro.enable": true
}
```

## 5. Problemas Comuns e Soluções

### 5.1 Erros de Instalação

**Erro: "rustup: command not found"**
```bash
# Solução: Recarregar shell ou adicionar PATH manualmente
source ~/.cargo/env
# ou
export PATH="$HOME/.cargo/bin:$PATH"
```

**Erro: "failed to run custom build command"**
```bash
# Instalar dependências do sistema
# Ubuntu/Debian:
sudo apt install build-essential pkg-config libssl-dev

# Fedora:
sudo dnf install gcc openssl-devel pkg-config

# macOS:
xcode-select --install
```

### 5.2 Problemas de Build

**Erro: "linking with `cc` failed"**
```bash
# Instalar linker
# Ubuntu:
sudo apt install gcc-multilib

# Ou usar lld (mais rápido)
sudo apt install lld
export RUSTFLAGS="-C link-arg=-fuse-ld=lld"
```

**Erro: "failed to resolve dependencies"**
```bash
# Limpar cache e recompilar
cargo clean
rm Cargo.lock
cargo build
```

**Erro: "disk space"**
```bash
# Limpar builds antigos
cargo clean

# Limpar cache global
cargo install cargo-cache
cargo cache --autoclean
```

### 5.3 Problemas de Performance

**Build muito lento:**
```bash
# Usar ramdisk para target/
mkdir /tmp/rust-builds
export CARGO_TARGET_DIR=/tmp/rust-builds

# Ou configurar permanentemente
echo 'export CARGO_TARGET_DIR=/tmp/rust-builds' >> ~/.bashrc
```

**Muitas recompilações:**
```bash
# Verificar mudanças desnecessárias
cargo build --timings

# Usar incremental compilation
export CARGO_INCREMENTAL=1
```

### 5.4 Problemas de Dependências

**Conflitos de versão:**
```bash
# Verificar árvore de dependências
cargo tree

# Forçar versão específica
[dependencies]
serde = "=1.0.136"  # Versão exata
```

**Crates não encontrados:**
```bash
# Verificar registry
cargo search nome_crate

# Limpar registry
rm -rf ~/.cargo/registry/cache
cargo build
```

## 6. Comandos Úteis do Dia a Dia

### 6.1 Cargo Commands

```bash
# Desenvolvimento
cargo new projeto                  # Criar projeto
cargo init                        # Inicializar em dir existente
cargo build                       # Compilar
cargo run                         # Executar
cargo test                        # Testar
cargo check                       # Verificar sem gerar binário

# Manutenção
cargo clean                       # Limpar builds
cargo update                      # Atualizar dependências
cargo audit                       # Verificar vulnerabilidades
cargo outdated                    # Verificar atualizações

# Informações
cargo tree                        # Árvore de dependências
cargo metadata                    # Metadados do projeto
cargo --version                   # Versão do cargo
```

### 6.2 Rustup Commands

```bash
# Toolchains
rustup update                     # Atualizar Rust
rustup show                       # Mostrar toolchains
rustup default stable            # Definir toolchain padrão
rustup target list               # Listar targets disponíveis
rustup target add wasm32-unknown-unknown  # Adicionar target

# Componentes
rustup component add clippy       # Adicionar clippy
rustup component add rustfmt      # Adicionar rustfmt
rustup component add rust-src     # Código fonte (para IDE)
```

### 6.3 Configuração Avançada

**~/.cargo/config.toml completo:**
```toml
[alias]
b = "build"
r = "run"
t = "test"
c = "check"

[build]
rustc-wrapper = "sccache"
target-dir = "/tmp/rust-builds"
jobs = 8

[target.x86_64-unknown-linux-gnu]
linker = "clang"
rustflags = ["-C", "link-arg=-fuse-ld=lld"]

[registry]
default = "crates-io"

[net]
retry = 2
git-fetch-with-cli = true
```

## 7. Comparação com Node.js

| Aspecto | Node.js | Rust |
|---------|---------|------|
| **Gerenciador** | npm/yarn/pnpm | cargo |
| **Arquivo config** | package.json | Cargo.toml |
| **Lock file** | package-lock.json | Cargo.lock |
| **Build** | Não precisa | Compilação obrigatória |
| **Cache global** | ~/.npm | ~/.cargo/registry |
| **Scripts** | npm run script | cargo run |
| **Dependências** | node_modules/ | target/deps/ |

**Similaridades:**
- Ambos têm registry central (npm vs crates.io)
- Versionamento semântico
- Dev dependencies separadas
- Scripts personalizados

**Diferenças:**
- Rust compila para binário nativo
- Cache de dependências é global no Rust
- Rust tem verificação de tipos em tempo de compilação
- Build time maior, mas runtime mais rápido

Rust oferece muito mais controle sobre o ambiente de desenvolvimento, mas também requer mais configuração inicial. A performance superior e a segurança compensam a curva de aprendizado!